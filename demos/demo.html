<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üß† Aksio - Complete Learning Platform Demo</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        h1 {
            text-align: center;
            color: white;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
            margin-bottom: 30px;
            font-size: 2.5em;
        }
        .container {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.15);
            margin-bottom: 25px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
        }
        .container h2 {
            margin-top: 0;
            color: #333;
            border-bottom: 2px solid #e9ecef;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        .form-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        label {
            font-weight: bold;
            color: #333;
        }
        input, select, textarea, button {
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
            font-family: inherit;
        }
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.1);
        }
        button {
            background: linear-gradient(135deg, #007bff, #0056b3);
            color: white;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            box-shadow: 0 4px 15px rgba(0, 123, 255, 0.3);
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 123, 255, 0.4);
        }
        button:disabled {
            background-color: #6c757d;
            cursor: not-allowed;
            transform: none;
        }
        .btn-success {
            background: linear-gradient(135deg, #28a745, #20c997);
            box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
        }
        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(40, 167, 69, 0.4);
        }
        .btn-warning {
            background: linear-gradient(135deg, #ffc107, #fd7e14);
            color: #212529;
            box-shadow: 0 4px 15px rgba(255, 193, 7, 0.3);
        }
        .btn-warning:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 193, 7, 0.4);
        }
        .btn-secondary {
            background: linear-gradient(135deg, #6c757d, #495057);
            color: white;
            border: none;
            padding: 8px 16px;
            margin-left: 10px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 12px;
            box-shadow: 0 2px 8px rgba(108, 117, 125, 0.3);
        }
        .btn-secondary:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(108, 117, 125, 0.4);
        }
        .main-tabs {
            display: flex;
            border-bottom: 2px solid #e9ecef;
            margin-bottom: 20px;
            background: linear-gradient(to right, #f8f9fa, #e9ecef);
            border-radius: 8px 8px 0 0;
            overflow: hidden;
        }
        .main-tab {
            padding: 15px 25px;
            cursor: pointer;
            border: none;
            background: transparent;
            border-bottom: 3px solid transparent;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.3s ease;
            position: relative;
            flex: 1;
            text-align: center;
        }
        .main-tab:hover {
            background: rgba(0, 123, 255, 0.1);
            color: #007bff;
        }
        .main-tab.active {
            background: white;
            border-bottom-color: #007bff;
            color: #007bff;
            font-weight: bold;
            box-shadow: 0 -2px 8px rgba(0, 123, 255, 0.2);
        }
        .main-tab.active::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #007bff, #0056b3);
        }
        .main-tab-content {
            display: none;
        }
        .main-tab-content.active {
            display: block;
        }
        .sub-tabs {
            display: flex;
            border-bottom: 1px solid #dee2e6;
            margin-bottom: 15px;
            background: #f8f9fa;
            border-radius: 6px;
            overflow: hidden;
        }
        .sub-tab {
            padding: 10px 20px;
            cursor: pointer;
            border: none;
            background: transparent;
            border-bottom: 2px solid transparent;
            font-size: 14px;
            transition: all 0.3s ease;
            flex: 1;
            text-align: center;
        }
        .sub-tab:hover {
            background: rgba(0, 123, 255, 0.1);
            color: #007bff;
        }
        .sub-tab.active {
            background: white;
            border-bottom-color: #007bff;
            color: #007bff;
            font-weight: bold;
        }
        .sub-tab-content {
            display: none;
        }
        .sub-tab-content.active {
            display: block;
        }
        .results-container {
            max-height: 400px;
            overflow-y: auto;
            border: 2px solid #e9ecef;
            padding: 20px;
            background: linear-gradient(145deg, #f8f9fa, #e9ecef);
            border-radius: 12px;
            white-space: pre-wrap;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
            font-family: 'Courier New', monospace;
            font-size: 13px;
        }
        .events-container {
            height: 300px;
            overflow-y: auto;
            border: 1px solid #ddd;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 8px;
        }
        .event {
            margin-bottom: 8px;
            padding: 8px;
            border-radius: 4px;
            border-left: 4px solid #007bff;
            background-color: white;
            font-size: 13px;
        }
        .event.error {
            border-left-color: #dc3545;
            background-color: #f8d7da;
        }
        .event.success {
            border-left-color: #28a745;
            background-color: #d4edda;
        }
        .event-type {
            font-weight: bold;
            color: #007bff;
        }
        .event.error .event-type {
            color: #dc3545;
        }
        .event.success .event-type {
            color: #28a745;
        }
        .timestamp {
            font-size: 11px;
            color: #6c757d;
            float: right;
        }
        .auth-status {
            padding: 10px;
            border-radius: 8px;
            margin-top: 10px;
        }
        .auth-success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .auth-error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .course-info {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin-top: 15px;
            box-shadow: 0 4px 8px rgba(40, 167, 69, 0.3);
        }
        .course-info h4 {
            margin-top: 0;
            margin-bottom: 15px;
        }
        .course-info p {
            margin-bottom: 8px;
            opacity: 0.95;
        }
        .course-info strong {
            opacity: 1;
        }
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        .metric-card {
            background: linear-gradient(145deg, #ffffff, #f8f9fa);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 6px 20px rgba(0,0,0,0.1);
            text-align: center;
            border: 1px solid rgba(0,123,255,0.1);
            transition: transform 0.3s ease;
        }
        .metric-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        .metric-value {
            font-size: 1.8em;
            font-weight: bold;
            color: #007bff;
        }
        .metric-label {
            color: #6c757d;
            margin-top: 5px;
            font-size: 0.9em;
        }
        .file-upload-area {
            border: 2px dashed #007bff;
            border-radius: 8px;
            padding: 40px;
            text-align: center;
            background: #f8f9fa;
            transition: all 0.3s ease;
        }
        .file-upload-area:hover {
            background: #e3f2fd;
            border-color: #0056b3;
        }
        .file-upload-area.dragover {
            background: #e3f2fd;
            border-color: #0056b3;
            transform: scale(1.02);
        }
        .documents-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        .document-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            border: 1px solid #e9ecef;
            transition: all 0.3s ease;
        }
        .document-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
        }
        .document-title {
            font-weight: bold;
            margin-bottom: 8px;
            color: #333;
        }
        .document-meta {
            font-size: 0.85em;
            color: #6c757d;
            margin-bottom: 5px;
        }
        .flashcard {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .flashcard:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
        }
        .flashcard.flipped {
            background: #e3f2fd;
            border-color: #007bff;
        }
        .flashcard-front, .flashcard-back {
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            font-size: 1.1em;
        }
        .flashcard-back {
            display: none;
        }
        .flashcard.flipped .flashcard-front {
            display: none;
        }
        .flashcard.flipped .flashcard-back {
            display: flex;
        }
        .quiz-question {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .quiz-options {
            margin-top: 15px;
        }
        .quiz-option {
            display: block;
            margin-bottom: 10px;
            padding: 10px;
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .quiz-option:hover {
            background: #e9ecef;
        }
        .quiz-option.selected {
            background: #e3f2fd;
            border-color: #007bff;
        }
        .insight-card {
            background: #f8f9fa;
            border-left: 4px solid #007bff;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 4px;
        }
        .schedule-session {
            background: linear-gradient(145deg, #ffffff, #f8f9fa);
            border: 2px solid #e9ecef;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            transition: all 0.3s ease;
        }
        .schedule-session:hover {
            transform: translateX(5px);
            border-color: #007bff;
            box-shadow: 0 6px 20px rgba(0,123,255,0.15);
        }
        .session-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .session-meta {
            font-size: 0.9em;
            color: #6c757d;
        }
        .health-status {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            margin-bottom: 15px;
        }
        .status-item {
            padding: 8px 12px;
            border-radius: 6px;
            text-align: center;
            font-size: 0.85em;
            font-weight: 500;
        }
        .status-healthy {
            background-color: #d4edda;
            color: #155724;
        }
        .status-unhealthy {
            background-color: #f8d7da;
            color: #721c24;
        }
        .status-unknown {
            background-color: #f8f9fa;
            color: #6c757d;
        }
        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
            .main-tabs {
                flex-direction: column;
            }
            .documents-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <h1>üß† Aksio - Complete Learning Platform Demo</h1>
    
    <!-- Authentication Section -->
    <div class="container">
        <h2>üîê Authentication</h2>
        <div class="form-grid">
            <div class="form-group">
                <label for="username">Username:</label>
                <input type="text" id="username" placeholder="Enter username" value="olav">
            </div>
            <div class="form-group">
                <label for="password">Password:</label>
                <input type="password" id="password" placeholder="Enter password" value="testpass123">
            </div>
        </div>
        <button onclick="authenticate()">Login</button>
        <div id="auth-status"></div>
    </div>

    <!-- Course Management Section -->
    <div class="container" id="course-management" style="display: none;">
        <h2>üìö Course Management</h2>
        <div class="form-grid">
            <div class="form-group">
                <label for="existing-courses">Select Existing Course:</label>
                <select id="existing-courses" onchange="selectCourse()">
                    <option value="">-- Select a course --</option>
                </select>
                <button onclick="loadUserCourses()" class="btn-secondary">Refresh Courses</button>
            </div>
            <div class="form-group">
                <label>Or Create New Course:</label>
                <input type="text" id="new-course-name" placeholder="Course name">
                <textarea id="new-course-description" placeholder="Course description" rows="2"></textarea>
                <button onclick="createNewCourse()" class="btn-success">Create Course</button>
            </div>
        </div>
        <div id="selected-course-info" class="course-info" style="display: none;">
            <h4>üìñ Selected Course</h4>
            <p><strong>Name:</strong> <span id="course-name-display"></span></p>
            <p><strong>ID:</strong> <span id="course-id-display"></span></p>
            <p><strong>Description:</strong> <span id="course-description-display"></span></p>
        </div>
    </div>

    <!-- Main Content Tabs -->
    <div class="container" id="main-content" style="display: none;">
        <div class="main-tabs">
            <button class="main-tab active" onclick="showMainTab('documents')">üìÑ Documents</button>
            <button class="main-tab" onclick="showMainTab('study-plans')">üìã Study Plans</button>
            <button class="main-tab" onclick="showMainTab('assessments')">üß† Assessments</button>
            <button class="main-tab" onclick="showMainTab('analytics')">üìä Analytics</button>
        </div>

        <!-- Documents Tab -->
        <div id="documents" class="main-tab-content active">
            <h3>üìÑ Document Management</h3>
            
            <div class="sub-tabs">
                <button class="sub-tab active" onclick="showSubTab('documents', 'upload')">Upload</button>
                <button class="sub-tab" onclick="showSubTab('documents', 'manage')">Manage</button>
                <button class="sub-tab" onclick="showSubTab('documents', 'health')">Health</button>
            </div>

            <!-- Document Upload -->
            <div id="documents-upload" class="sub-tab-content active">
                <div class="file-upload-area" id="fileUploadArea">
                    <div class="form-group">
                        <label for="documentFile">Choose File or Drag & Drop:</label>
                        <input type="file" id="documentFile" accept=".pdf,.doc,.docx,.txt,.md" multiple>
                    </div>
                    <p>or</p>
                    <div class="form-group">
                        <label for="documentUrl">Enter URL:</label>
                        <input type="url" id="documentUrl" placeholder="https://example.com/document.pdf">
                    </div>
                    <button onclick="uploadDocument()" class="btn-success">Upload Document</button>
                </div>
                
                <div class="events-container" id="uploadEvents">
                    <div class="event">
                        <span class="event-type">INFO</span>
                        <span class="timestamp">Ready</span>
                        <br>Document upload system ready. Select a course first.
                    </div>
                </div>
            </div>

            <!-- Document Management -->
            <div id="documents-manage" class="sub-tab-content">
                <button onclick="loadDocuments()" class="btn-secondary">Refresh Documents</button>
                <div id="documents-list" class="documents-grid">
                    <p>Select a course and click refresh to view documents.</p>
                </div>
            </div>

            <!-- Health Check -->
            <div id="documents-health" class="sub-tab-content">
                <button onclick="checkHealth()" class="btn-warning">Check System Health</button>
                <div id="health-status" class="health-status">
                    <div class="status-item status-unknown">Backend: Unknown</div>
                    <div class="status-item status-unknown">Database: Unknown</div>
                    <div class="status-item status-unknown">Processing: Unknown</div>
                    <div class="status-item status-unknown">Storage: Unknown</div>
                </div>
            </div>
        </div>

        <!-- Study Plans Tab -->
        <div id="study-plans" class="main-tab-content">
            <h3>üìã Adaptive Study Plans</h3>
            
            <div class="sub-tabs">
                <button class="sub-tab active" onclick="showSubTab('study-plans', 'generate')">Generate</button>
                <button class="sub-tab" onclick="showSubTab('study-plans', 'manage')">Manage</button>
                <button class="sub-tab" onclick="showSubTab('study-plans', 'override')">Override</button>
            </div>

            <!-- Generate Plan -->
            <div id="study-plans-generate" class="sub-tab-content active">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="plan-type">Plan Type:</label>
                        <select id="plan-type">
                            <option value="weekly">Weekly Plan</option>
                            <option value="monthly">Monthly Plan</option>
                            <option value="exam_prep">Exam Preparation</option>
                            <option value="custom">Custom Plan</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="target-date">Target Completion Date:</label>
                        <input type="date" id="target-date">
                    </div>
                    <div class="form-group">
                        <label for="daily-hours">Preferred Daily Hours:</label>
                        <input type="number" id="daily-hours" min="0.5" max="8" step="0.5" value="2">
                    </div>
                </div>
                <div class="form-group">
                    <label>Preferences:</label>
                    <div style="display: flex; gap: 10px; margin-top: 5px; flex-wrap: wrap;">
                        <label><input type="checkbox" id="prefer-short-sessions"> Short Sessions</label>
                        <label><input type="checkbox" id="include-weekends"> Include Weekends</label>
                        <label><input type="checkbox" id="high-intensity"> High Intensity</label>
                    </div>
                </div>
                <button onclick="generateStudyPlan()" class="btn-success">Generate Adaptive Plan</button>
                <div id="plan-results" class="results-container" style="display: none;"></div>
            </div>

            <!-- Manage Plans -->
            <div id="study-plans-manage" class="sub-tab-content">
                <button onclick="loadStudyPlans()" class="btn-secondary">Load Study Plans</button>
                <div id="study-plans-list">
                    <p>Click "Load Study Plans" to view your current plans.</p>
                </div>
            </div>

            <!-- Manual Override -->
            <div id="study-plans-override" class="sub-tab-content">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="override-plan-id">Study Plan ID:</label>
                        <input type="text" id="override-plan-id" placeholder="Enter study plan UUID">
                    </div>
                    <div class="form-group">
                        <label for="override-type">Override Type:</label>
                        <select id="override-type" onchange="showOverrideOptions()">
                            <option value="schedule">Schedule Modification</option>
                            <option value="difficulty">Difficulty Adjustment</option>
                            <option value="review_frequency">Review Frequency</option>
                        </select>
                    </div>
                </div>
                <div id="override-options">
                    <!-- Dynamic content based on override type -->
                </div>
                <div class="form-group">
                    <label for="override-reason">Reason for Override:</label>
                    <textarea id="override-reason" placeholder="Explain why you're making this change..."></textarea>
                </div>
                <button onclick="applyManualOverride()" class="btn-warning">Apply Override</button>
                <div id="override-results" class="results-container" style="display: none;"></div>
            </div>
        </div>

        <!-- Assessments Tab -->
        <div id="assessments" class="main-tab-content">
            <h3>üß† Assessments & Practice</h3>
            
            <div class="sub-tabs">
                <button class="sub-tab active" onclick="showSubTab('assessments', 'flashcards')">Flashcards</button>
                <button class="sub-tab" onclick="showSubTab('assessments', 'quizzes')">Quizzes</button>
                <button class="sub-tab" onclick="showSubTab('assessments', 'generate')">Generate</button>
            </div>

            <!-- Flashcards -->
            <div id="assessments-flashcards" class="sub-tab-content active">
                <button onclick="loadFlashcards()" class="btn-secondary">Load Flashcards</button>
                <button onclick="startFlashcardReview()" class="btn-success">Start Review Session</button>
                <div id="flashcards-container">
                    <p>Load flashcards to start practicing!</p>
                </div>
            </div>

            <!-- Quizzes -->
            <div id="assessments-quizzes" class="sub-tab-content">
                <button onclick="loadQuizzes()" class="btn-secondary">Load Quizzes</button>
                <button onclick="generateQuiz()" class="btn-success">Generate New Quiz</button>
                <div id="quiz-container">
                    <p>Load or generate quizzes to test your knowledge!</p>
                </div>
            </div>

            <!-- Generate Assessments -->
            <div id="assessments-generate" class="sub-tab-content">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="assessment-type">Assessment Type:</label>
                        <select id="assessment-type">
                            <option value="flashcards">Flashcards</option>
                            <option value="quiz">Quiz</option>
                            <option value="both">Both</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="assessment-topic">Topic (optional):</label>
                        <input type="text" id="assessment-topic" placeholder="e.g., Django Models">
                    </div>
                    <div class="form-group">
                        <label for="assessment-difficulty">Difficulty:</label>
                        <select id="assessment-difficulty">
                            <option value="easy">Easy</option>
                            <option value="medium">Medium</option>
                            <option value="hard">Hard</option>
                            <option value="mixed">Mixed</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="assessment-count">Number of Items:</label>
                        <input type="number" id="assessment-count" min="5" max="50" value="10">
                    </div>
                </div>
                <button onclick="generateAssessments()" class="btn-success">Generate Assessments</button>
                <div id="generate-results" class="results-container" style="display: none;"></div>
            </div>
        </div>

        <!-- Analytics Tab -->
        <div id="analytics" class="main-tab-content">
            <h3>üìä Learning Analytics</h3>
            
            <div class="sub-tabs">
                <button class="sub-tab active" onclick="showSubTab('analytics', 'performance')">Performance</button>
                <button class="sub-tab" onclick="showSubTab('analytics', 'predictions')">Predictions</button>
                <button class="sub-tab" onclick="showSubTab('analytics', 'dashboard')">Dashboard</button>
            </div>

            <!-- Performance Analysis -->
            <div id="analytics-performance" class="sub-tab-content active">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="analysis-days">Time Period (days):</label>
                        <input type="number" id="analysis-days" value="30" min="7" max="365">
                    </div>
                </div>
                <button onclick="getPerformanceAnalysis()">Analyze Performance</button>
                <div id="performance-results"></div>
            </div>

            <!-- Progress Predictions -->
            <div id="analytics-predictions" class="sub-tab-content">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="mastery-level">Target Mastery Level:</label>
                        <select id="mastery-level">
                            <option value="3">Level 3 - Good Understanding</option>
                            <option value="4" selected>Level 4 - Proficient</option>
                            <option value="5">Level 5 - Expert</option>
                        </select>
                    </div>
                </div>
                <button onclick="getProgressPredictions()">Get Predictions</button>
                <div id="prediction-results"></div>
            </div>

            <!-- Dashboard -->
            <div id="analytics-dashboard" class="sub-tab-content">
                <button onclick="loadDashboard()">Load Dashboard</button>
                <div id="dashboard-content">
                    <p>Click "Load Dashboard" to view your learning analytics.</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        let authToken = null;
        let selectedCourseId = null;
        const API_BASE = 'http://localhost:8000/api/v1';

        // Authentication
        async function authenticate() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            try {
                const response = await fetch(`${API_BASE}/accounts/login/`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ username, password })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    authToken = data.access;
                    document.getElementById('auth-status').innerHTML = 
                        '<div class="auth-status auth-success">‚úÖ Authenticated successfully</div>';
                    
                    // Show course management and load courses
                    document.getElementById('course-management').style.display = 'block';
                    await loadUserCourses();
                } else {
                    const error = await response.text();
                    document.getElementById('auth-status').innerHTML = 
                        `<div class="auth-status auth-error">‚ùå Authentication failed: ${error}</div>`;
                }
            } catch (error) {
                document.getElementById('auth-status').innerHTML = 
                    `<div class="auth-status auth-error">‚ùå Error: ${error.message}</div>`;
            }
        }

        // Course Management
        async function loadUserCourses() {
            if (!authToken) {
                alert('Please authenticate first');
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/courses/courses/`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    populateCourseSelect(data.results || data);
                } else {
                    console.error('Failed to load courses');
                }
            } catch (error) {
                console.error('Error loading courses:', error);
            }
        }

        function populateCourseSelect(courses) {
            const select = document.getElementById('existing-courses');
            select.innerHTML = '<option value="">-- Select a course --</option>';
            
            courses.forEach(course => {
                const option = document.createElement('option');
                option.value = course.id;
                option.textContent = `${course.name} (${course.total_documents || 0} docs)`;
                option.dataset.name = course.name;
                option.dataset.description = course.description || 'No description';
                select.appendChild(option);
            });
        }

        function selectCourse() {
            const select = document.getElementById('existing-courses');
            const selectedOption = select.options[select.selectedIndex];
            
            if (selectedOption.value) {
                selectedCourseId = selectedOption.value;
                const courseName = selectedOption.dataset.name;
                const courseDescription = selectedOption.dataset.description;
                
                // Update course info display
                document.getElementById('course-name-display').textContent = courseName;
                document.getElementById('course-id-display').textContent = selectedCourseId;
                document.getElementById('course-description-display').textContent = courseDescription;
                document.getElementById('selected-course-info').style.display = 'block';
                
                // Show main content
                document.getElementById('main-content').style.display = 'block';
                
                // Update upload events
                addEvent('uploadEvents', 'INFO', `Course selected: ${courseName}`);
            } else {
                selectedCourseId = null;
                document.getElementById('selected-course-info').style.display = 'none';
                document.getElementById('main-content').style.display = 'none';
            }
        }

        async function createNewCourse() {
            const name = document.getElementById('new-course-name').value.trim();
            const description = document.getElementById('new-course-description').value.trim();
            
            if (!name) {
                alert('Please enter a course name');
                return;
            }

            if (!authToken) {
                alert('Please authenticate first');
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/courses/courses/`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        name: name,
                        description: description
                    })
                });
                
                if (response.ok) {
                    const newCourse = await response.json();
                    
                    // Clear form
                    document.getElementById('new-course-name').value = '';
                    document.getElementById('new-course-description').value = '';
                    
                    // Reload courses and select the new one
                    await loadUserCourses();
                    
                    // Auto-select the new course
                    const select = document.getElementById('existing-courses');
                    select.value = newCourse.id;
                    selectCourse();
                    
                    alert(`Course "${name}" created successfully!`);
                } else {
                    const error = await response.text();
                    alert(`Failed to create course: ${error}`);
                }
            } catch (error) {
                alert(`Error creating course: ${error.message}`);
            }
        }

        // Tab Management
        function showMainTab(tabName) {
            // Hide all main tab contents
            document.querySelectorAll('.main-tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Remove active class from all main tabs
            document.querySelectorAll('.main-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab content
            document.getElementById(tabName).classList.add('active');
            
            // Add active class to clicked tab
            event.target.classList.add('active');
        }

        function showSubTab(mainTab, subTab) {
            // Hide all sub tab contents for this main tab
            document.querySelectorAll(`#${mainTab} .sub-tab-content`).forEach(content => {
                content.classList.remove('active');
            });
            
            // Remove active class from all sub tabs for this main tab
            document.querySelectorAll(`#${mainTab} .sub-tab`).forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected sub tab content
            document.getElementById(`${mainTab}-${subTab}`).classList.add('active');
            
            // Add active class to clicked sub tab
            event.target.classList.add('active');
        }

        // Document Upload Functions
        function addEvent(containerId, type, message) {
            const container = document.getElementById(containerId);
            const event = document.createElement('div');
            event.className = `event ${type.toLowerCase()}`;
            
            const timestamp = new Date().toLocaleTimeString();
            event.innerHTML = `
                <span class="event-type">${type}</span>
                <span class="timestamp">${timestamp}</span>
                <br>${message}
            `;
            
            container.insertBefore(event, container.firstChild);
            
            // Keep only last 50 events
            while (container.children.length > 50) {
                container.removeChild(container.lastChild);
            }
        }

        async function uploadDocument() {
            if (!selectedCourseId) {
                alert('Please select a course first');
                return;
            }

            const fileInput = document.getElementById('documentFile');
            const urlInput = document.getElementById('documentUrl');
            const file = fileInput.files[0];
            const url = urlInput.value.trim();

            if (!file && !url) {
                alert('Please select a file or enter a URL');
                return;
            }

            const formData = new FormData();

            if (file) {
                formData.append('file', file);
                addEvent('uploadEvents', 'INFO', `Starting upload: ${file.name}`);
            } else {
                formData.append('url', url);
                addEvent('uploadEvents', 'INFO', `Starting URL processing: ${url}`);
            }

            try {
                const response = await fetch(`${API_BASE}/courses/courses/${selectedCourseId}/documents/upload/`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: formData
                });

                if (response.ok) {
                    const result = await response.json();
                    addEvent('uploadEvents', 'SUCCESS', `Upload successful! Document ID: ${result.id}`);
                    
                    // Clear inputs
                    fileInput.value = '';
                    urlInput.value = '';
                } else {
                    const error = await response.text();
                    addEvent('uploadEvents', 'ERROR', `Upload failed: ${error}`);
                }
            } catch (error) {
                addEvent('uploadEvents', 'ERROR', `Upload error: ${error.message}`);
            }
        }

        async function loadDocuments() {
            if (!selectedCourseId) {
                alert('Please select a course first');
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/courses/courses/${selectedCourseId}/documents/`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    displayDocuments(data.results || data);
                } else {
                    const error = await response.text();
                    document.getElementById('documents-list').innerHTML = `<p>Error loading documents: ${error}</p>`;
                }
            } catch (error) {
                document.getElementById('documents-list').innerHTML = `<p>Error: ${error.message}</p>`;
            }
        }

        function displayDocuments(documents) {
            const container = document.getElementById('documents-list');
            
            if (!documents || documents.length === 0) {
                container.innerHTML = '<p>No documents found. Upload some documents first!</p>';
                return;
            }

            container.innerHTML = documents.map(doc => `
                <div class="document-card">
                    <div class="document-title">${doc.name}</div>
                    <div class="document-meta">Type: ${doc.document_type.toUpperCase()}</div>
                    <div class="document-meta">Size: ${formatFileSize(doc.file_size_bytes)}</div>
                    <div class="document-meta">Status: ${doc.processing_status}</div>
                    <div class="document-meta">Uploaded: ${new Date(doc.created_at).toLocaleDateString()}</div>
                    ${doc.description ? `<div class="document-meta">Description: ${doc.description}</div>` : ''}
                </div>
            `).join('');
        }

        function formatFileSize(bytes) {
            if (!bytes) return 'Unknown';
            const sizes = ['B', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(1024));
            return (bytes / Math.pow(1024, i)).toFixed(1) + ' ' + sizes[i];
        }

        async function checkHealth() {
            try {
                const response = await fetch('/api/health/', {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });

                if (response.ok) {
                    const health = await response.json();
                    updateHealthStatus(health);
                } else {
                    updateHealthStatus({ status: 'error', message: 'Health check failed' });
                }
            } catch (error) {
                updateHealthStatus({ status: 'error', message: error.message });
            }
        }

        function updateHealthStatus(health) {
            const container = document.getElementById('health-status');
            const isHealthy = health.status === 'healthy';
            
            container.innerHTML = `
                <div class="status-item ${isHealthy ? 'status-healthy' : 'status-unhealthy'}">
                    Backend: ${isHealthy ? 'Healthy' : 'Error'}
                </div>
                <div class="status-item ${isHealthy ? 'status-healthy' : 'status-unhealthy'}">
                    Database: ${isHealthy ? 'Connected' : 'Error'}
                </div>
                <div class="status-item ${isHealthy ? 'status-healthy' : 'status-unhealthy'}">
                    Processing: ${isHealthy ? 'Ready' : 'Error'}
                </div>
                <div class="status-item ${isHealthy ? 'status-healthy' : 'status-unhealthy'}">
                    Storage: ${isHealthy ? 'Available' : 'Error'}
                </div>
            `;
        }

        // Study Plan Functions
        async function generateStudyPlan() {
            if (!selectedCourseId) {
                alert('Please select a course first');
                return;
            }

            const planType = document.getElementById('plan-type').value;
            const targetDate = document.getElementById('target-date').value;
            const dailyHours = parseFloat(document.getElementById('daily-hours').value);
            
            const preferences = {
                intensity_multiplier: document.getElementById('high-intensity').checked ? 1.3 : 1.0,
                prefer_short_sessions: document.getElementById('prefer-short-sessions').checked,
                include_weekends: document.getElementById('include-weekends').checked,
                daily_hours: dailyHours
            };

            try {
                const response = await fetch(`${API_BASE}/learning/adaptive/generate_adaptive_plan/`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        course_id: selectedCourseId,
                        plan_type: planType,
                        target_date: targetDate || null,
                        preferences: preferences
                    })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    displayPlanResults(data);
                } else {
                    const error = await response.text();
                    document.getElementById('plan-results').style.display = 'block';
                    document.getElementById('plan-results').textContent = `Error: ${error}`;
                }
            } catch (error) {
                document.getElementById('plan-results').style.display = 'block';
                document.getElementById('plan-results').textContent = `Error: ${error.message}`;
            }
        }

        function displayPlanResults(data) {
            const container = document.getElementById('plan-results');
            container.style.display = 'block';
            
            const schedule = data.plan_data?.schedule || [];
            const adaptations = data.plan_data?.adaptations_made || [];
            const recommendations = data.recommendations || [];
            
            container.innerHTML = `
                <h4>‚úÖ Adaptive Study Plan Generated!</h4>
                <p><strong>Study Plan ID:</strong> ${data.study_plan_id}</p>
                <p><strong>Estimated Completion:</strong> ${data.plan_data?.estimated_completion || 'Not available'}</p>
                
                <h5>üìã Adaptations Made:</h5>
                <ul>
                    ${adaptations.map(adaptation => `<li>${adaptation}</li>`).join('') || '<li>No specific adaptations</li>'}
                </ul>
                
                <h5>üìÖ Schedule (First 5 Sessions):</h5>
                ${schedule.slice(0, 5).map(session => `
                    <div class="schedule-session">
                        <div class="session-header">
                            <strong>${session.content?.focus_topic || 'Study Session'}</strong>
                            <span class="session-meta">${session.date} at ${session.start_time}</span>
                        </div>
                        <div class="session-meta">
                            Duration: ${session.duration_minutes} minutes | 
                            Week: ${session.week} | 
                            Load: ${session.estimated_cognitive_load?.toFixed(1) || 'N/A'}
                        </div>
                    </div>
                `).join('') || '<p>No schedule available</p>'}
                
                <h5>üí° Recommendations:</h5>
                <ul>
                    ${recommendations.map(rec => `
                        <li class="insight-card">
                            <strong>${rec.title}</strong><br>
                            ${rec.description}
                        </li>
                    `).join('') || '<li>No recommendations available</li>'}
                </ul>
            `;
        }

        async function loadStudyPlans() {
            if (!selectedCourseId) {
                alert('Please select a course first');
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/learning/study-plans/?course_id=${selectedCourseId}`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    displayStudyPlans(data.results || data);
                } else {
                    const error = await response.text();
                    document.getElementById('study-plans-list').innerHTML = `<p>Error loading plans: ${error}</p>`;
                }
            } catch (error) {
                document.getElementById('study-plans-list').innerHTML = `<p>Error: ${error.message}</p>`;
            }
        }

        function displayStudyPlans(plans) {
            const container = document.getElementById('study-plans-list');
            
            if (!plans || plans.length === 0) {
                container.innerHTML = '<p>No study plans found. Generate one first!</p>';
                return;
            }

            container.innerHTML = plans.map(plan => `
                <div class="schedule-session">
                    <div class="session-header">
                        <strong>${plan.title}</strong>
                        <span class="session-meta">Status: ${plan.status}</span>
                    </div>
                    <div class="session-meta">
                        Type: ${plan.plan_type} | 
                        Progress: ${plan.progress_percentage?.toFixed(1) || 0}% | 
                        Created: ${new Date(plan.created_at).toLocaleDateString()}
                    </div>
                    <p>${plan.description}</p>
                    <button onclick="selectPlanForOverride('${plan.id}')" class="btn-secondary">Use for Override</button>
                </div>
            `).join('');
        }

        function selectPlanForOverride(planId) {
            document.getElementById('override-plan-id').value = planId;
            showMainTab('study-plans');
            showSubTab('study-plans', 'override');
        }

        function showOverrideOptions() {
            const overrideType = document.getElementById('override-type').value;
            const container = document.getElementById('override-options');
            
            switch (overrideType) {
                case 'schedule':
                    container.innerHTML = `
                        <h4>Schedule Modification</h4>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="session-id">Session ID:</label>
                                <input type="text" id="session-id" placeholder="Enter session ID to modify">
                            </div>
                            <div class="form-group">
                                <label for="new-date">New Date:</label>
                                <input type="date" id="new-date">
                            </div>
                            <div class="form-group">
                                <label for="new-time">New Time:</label>
                                <input type="time" id="new-time">
                            </div>
                        </div>
                    `;
                    break;
                case 'difficulty':
                    container.innerHTML = `
                        <h4>Difficulty Adjustment</h4>
                        <div class="form-group">
                            <label for="difficulty-adjustment">Difficulty Change:</label>
                            <select id="difficulty-adjustment">
                                <option value="-1">Make Easier (-1)</option>
                                <option value="0">Keep Current (0)</option>
                                <option value="1">Make Harder (+1)</option>
                            </select>
                        </div>
                    `;
                    break;
                case 'review_frequency':
                    container.innerHTML = `
                        <h4>Review Frequency</h4>
                        <div class="form-group">
                            <label for="frequency-days">Review Every (days):</label>
                            <input type="number" id="frequency-days" min="1" max="30" value="3">
                        </div>
                    `;
                    break;
            }
        }

        async function applyManualOverride() {
            const planId = document.getElementById('override-plan-id').value;
            const overrideType = document.getElementById('override-type').value;
            const reason = document.getElementById('override-reason').value;
            
            if (!planId) {
                alert('Please enter a study plan ID');
                return;
            }
            
            let overrideData = {};
            
            switch (overrideType) {
                case 'schedule':
                    overrideData = {
                        session_id: document.getElementById('session-id').value,
                        new_date: document.getElementById('new-date').value,
                        new_time: document.getElementById('new-time').value
                    };
                    break;
                case 'difficulty':
                    overrideData = {
                        adjustment: parseInt(document.getElementById('difficulty-adjustment').value)
                    };
                    break;
                case 'review_frequency':
                    overrideData = {
                        frequency_days: parseInt(document.getElementById('frequency-days').value)
                    };
                    break;
            }
            
            try {
                const response = await fetch(`${API_BASE}/learning/adaptive/manual_override/`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        study_plan_id: planId,
                        override_type: overrideType,
                        override_data: overrideData,
                        reason: reason
                    })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    document.getElementById('override-results').style.display = 'block';
                    document.getElementById('override-results').textContent = 
                        `‚úÖ Override applied successfully!\n\n${JSON.stringify(data, null, 2)}`;
                } else {
                    const error = await response.text();
                    document.getElementById('override-results').style.display = 'block';
                    document.getElementById('override-results').textContent = `Error: ${error}`;
                }
            } catch (error) {
                document.getElementById('override-results').style.display = 'block';
                document.getElementById('override-results').textContent = `Error: ${error.message}`;
            }
        }

        // Assessment Functions
        async function loadFlashcards() {
            if (!selectedCourseId) {
                alert('Please select a course first');
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/assessments/flashcards/?course_id=${selectedCourseId}`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    displayFlashcards(data.results || data);
                } else {
                    const error = await response.text();
                    document.getElementById('flashcards-container').innerHTML = `<p>Error loading flashcards: ${error}</p>`;
                }
            } catch (error) {
                document.getElementById('flashcards-container').innerHTML = `<p>Error: ${error.message}</p>`;
            }
        }

        function displayFlashcards(flashcards) {
            const container = document.getElementById('flashcards-container');
            
            if (!flashcards || flashcards.length === 0) {
                container.innerHTML = '<p>No flashcards found. Generate some first!</p>';
                return;
            }

            container.innerHTML = flashcards.map((card, index) => `
                <div class="flashcard" onclick="flipCard(${index})" id="flashcard-${index}">
                    <div class="flashcard-front">
                        <strong>Question:</strong><br>
                        ${card.front}
                    </div>
                    <div class="flashcard-back">
                        <strong>Answer:</strong><br>
                        ${card.back}
                    </div>
                </div>
            `).join('');
        }

        function flipCard(index) {
            const card = document.getElementById(`flashcard-${index}`);
            card.classList.toggle('flipped');
        }

        async function startFlashcardReview() {
            if (!selectedCourseId) {
                alert('Please select a course first');
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/assessments/flashcards/review/?course_id=${selectedCourseId}`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    alert(`Review session started! You have ${data.review_count || 0} cards to review.`);
                    loadFlashcards();
                } else {
                    const error = await response.text();
                    alert(`Error starting review: ${error}`);
                }
            } catch (error) {
                alert(`Error: ${error.message}`);
            }
        }

        async function loadQuizzes() {
            if (!selectedCourseId) {
                alert('Please select a course first');
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/assessments/quizzes/?course_id=${selectedCourseId}`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    displayQuizzes(data.results || data);
                } else {
                    const error = await response.text();
                    document.getElementById('quiz-container').innerHTML = `<p>Error loading quizzes: ${error}</p>`;
                }
            } catch (error) {
                document.getElementById('quiz-container').innerHTML = `<p>Error: ${error.message}</p>`;
            }
        }

        function displayQuizzes(quizzes) {
            const container = document.getElementById('quiz-container');
            
            if (!quizzes || quizzes.length === 0) {
                container.innerHTML = '<p>No quizzes found. Generate some first!</p>';
                return;
            }

            container.innerHTML = quizzes.map(quiz => `
                <div class="quiz-question">
                    <h4>${quiz.title}</h4>
                    <p>${quiz.description}</p>
                    <div class="session-meta">
                        Questions: ${quiz.question_count || 'Unknown'} | 
                        Created: ${new Date(quiz.created_at).toLocaleDateString()}
                    </div>
                    <button onclick="takeQuiz('${quiz.id}')" class="btn-success">Take Quiz</button>
                </div>
            `).join('');
        }

        async function takeQuiz(quizId) {
            try {
                const response = await fetch(`${API_BASE}/assessments/quizzes/${quizId}/take/`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    alert(`Quiz started! Good luck!`);
                    // You could implement a quiz taking interface here
                } else {
                    const error = await response.text();
                    alert(`Error taking quiz: ${error}`);
                }
            } catch (error) {
                alert(`Error: ${error.message}`);
            }
        }

        async function generateQuiz() {
            if (!selectedCourseId) {
                alert('Please select a course first');
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/assessments/quizzes/generate/`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        course_id: selectedCourseId,
                        question_count: 10,
                        difficulty: 'medium'
                    })
                });

                if (response.ok) {
                    const data = await response.json();
                    alert(`Quiz generated successfully! Quiz ID: ${data.quiz_id}`);
                    loadQuizzes();
                } else {
                    const error = await response.text();
                    alert(`Error generating quiz: ${error}`);
                }
            } catch (error) {
                alert(`Error: ${error.message}`);
            }
        }

        async function generateAssessments() {
            if (!selectedCourseId) {
                alert('Please select a course first');
                return;
            }

            const assessmentType = document.getElementById('assessment-type').value;
            const topic = document.getElementById('assessment-topic').value;
            const difficulty = document.getElementById('assessment-difficulty').value;
            const count = parseInt(document.getElementById('assessment-count').value);

            try {
                let promises = [];

                if (assessmentType === 'flashcards' || assessmentType === 'both') {
                    promises.push(fetch(`${API_BASE}/assessments/flashcards/generate/`, {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${authToken}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            course_id: selectedCourseId,
                            topic: topic,
                            difficulty: difficulty,
                            count: count
                        })
                    }));
                }

                if (assessmentType === 'quiz' || assessmentType === 'both') {
                    promises.push(fetch(`${API_BASE}/assessments/quizzes/generate/`, {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${authToken}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            course_id: selectedCourseId,
                            topic: topic,
                            difficulty: difficulty,
                            question_count: count
                        })
                    }));
                }

                const results = await Promise.all(promises);
                const successCount = results.filter(r => r.ok).length;
                
                document.getElementById('generate-results').style.display = 'block';
                document.getElementById('generate-results').textContent = 
                    `Generated ${successCount} assessment type(s) successfully!`;

            } catch (error) {
                document.getElementById('generate-results').style.display = 'block';
                document.getElementById('generate-results').textContent = `Error: ${error.message}`;
            }
        }

        // Analytics Functions
        async function getPerformanceAnalysis() {
            if (!selectedCourseId) {
                alert('Please select a course first');
                return;
            }

            const days = document.getElementById('analysis-days').value;
            
            try {
                const url = new URL(`${API_BASE}/learning/analytics/adaptive_performance_analysis/`);
                url.searchParams.append('course_id', selectedCourseId);
                url.searchParams.append('days', days);
                
                const response = await fetch(url, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    displayPerformanceResults(data);
                } else {
                    const error = await response.text();
                    document.getElementById('performance-results').innerHTML = 
                        `<div class="results-container">Error: ${error}</div>`;
                }
            } catch (error) {
                document.getElementById('performance-results').innerHTML = 
                    `<div class="results-container">Error: ${error.message}</div>`;
            }
        }

        function displayPerformanceResults(data) {
            const container = document.getElementById('performance-results');
            
            container.innerHTML = `
                <div class="metric-card">
                    <div class="metric-value">${data.overall_score?.toFixed(1) || 'N/A'}</div>
                    <div class="metric-label">${data.performance_category || 'Unknown'}</div>
                </div>
                
                <div class="insight-card">
                    <h4>üìä Detailed Analysis</h4>
                    <p><strong>Quiz Performance:</strong> ${data.detailed_analysis?.quiz_performance?.average_score?.toFixed(1) || 'N/A'}% average</p>
                    <p><strong>Study Sessions:</strong> ${data.detailed_analysis?.study_sessions?.completion_rate?.toFixed(1) || 'N/A'}% completion rate</p>
                    <p><strong>Learning Progress:</strong> ${data.detailed_analysis?.learning_progress?.topics_mastered || 0} topics mastered</p>
                </div>
                
                <div class="insight-card">
                    <h4>üí° Recommendations</h4>
                    <ul>
                        ${(data.recommendations || []).map(rec => `<li>${rec.title}: ${rec.description}</li>`).join('')}
                    </ul>
                </div>
            `;
        }

        async function getProgressPredictions() {
            if (!selectedCourseId) {
                alert('Please select a course first');
                return;
            }

            const masteryLevel = document.getElementById('mastery-level').value;
            
            try {
                // This would typically use a study plan ID, but for demo purposes we'll use course ID
                const response = await fetch(`${API_BASE}/learning/study-plans/predictions/?course_id=${selectedCourseId}&mastery_level=${masteryLevel}`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    displayPredictionResults(data);
                } else {
                    const error = await response.text();
                    document.getElementById('prediction-results').innerHTML = 
                        `<div class="results-container">Error: ${error}</div>`;
                }
            } catch (error) {
                document.getElementById('prediction-results').innerHTML = 
                    `<div class="results-container">Error: ${error.message}</div>`;
            }
        }

        function displayPredictionResults(data) {
            const container = document.getElementById('prediction-results');
            
            container.innerHTML = `
                <div class="insight-card">
                    <h4>üéØ Completion Prediction</h4>
                    <p><strong>Estimated Completion:</strong> ${data.completion_prediction?.estimated_completion_date || 'Unknown'}</p>
                    <p><strong>Weeks Remaining:</strong> ${data.completion_prediction?.weeks_remaining || 'Unknown'}</p>
                    <p><strong>Completion Probability:</strong> ${(data.completion_prediction?.completion_probability * 100)?.toFixed(1) || 'Unknown'}%</p>
                </div>
                
                <div class="insight-card">
                    <h4>üìà Current Progress</h4>
                    <p><strong>Topics Mastered:</strong> ${data.current_progress?.topics_mastered || 0}</p>
                    <p><strong>Completion:</strong> ${data.current_progress?.completion_percentage?.toFixed(1) || 0}%</p>
                </div>
            `;
        }

        async function loadDashboard() {
            try {
                const response = await fetch(`${API_BASE}/learning/adaptive/adaptive_dashboard/`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    displayDashboardData(data);
                } else {
                    document.getElementById('dashboard-content').innerHTML = 
                        '<p>Error loading dashboard. Make sure you have active study plans.</p>';
                }
            } catch (error) {
                document.getElementById('dashboard-content').innerHTML = 
                    `<p>Error: ${error.message}</p>`;
            }
        }

        function displayDashboardData(data) {
            const container = document.getElementById('dashboard-content');
            container.innerHTML = `
                <div class="dashboard-grid">
                    <div class="metric-card">
                        <div class="metric-value">${data.overall_performance?.score?.toFixed(1) || 'N/A'}</div>
                        <div class="metric-label">Overall Performance</div>
                        <div class="metric-label">${data.overall_performance?.category || 'Unknown'}</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value">${data.active_plans || 0}</div>
                        <div class="metric-label">Active Study Plans</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value">${data.review_workload?.today || 0}</div>
                        <div class="metric-label">Reviews Today</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value">${data.adaptation_status?.plans_adapted_this_week || 0}</div>
                        <div class="metric-label">Plans Adapted This Week</div>
                    </div>
                </div>
                
                <div class="insight-card">
                    <h4>üí™ Your Strengths</h4>
                    <ul>
                        ${(data.key_strengths || []).map(strength => `<li>${strength}</li>`).join('')}
                    </ul>
                </div>
                
                <div class="insight-card">
                    <h4>üéØ Areas for Improvement</h4>
                    <ul>
                        ${(data.improvement_areas || []).map(area => `<li>${area}</li>`).join('')}
                    </ul>
                </div>
            `;
        }

        // File upload drag and drop
        const fileUploadArea = document.getElementById('fileUploadArea');
        
        fileUploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            fileUploadArea.classList.add('dragover');
        });
        
        fileUploadArea.addEventListener('dragleave', () => {
            fileUploadArea.classList.remove('dragover');
        });
        
        fileUploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            fileUploadArea.classList.remove('dragover');
            
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                document.getElementById('documentFile').files = files;
            }
        });

        // Initialize override options on load
        window.onload = function() {
            showOverrideOptions();
        };
    </script>
</body>
</html>